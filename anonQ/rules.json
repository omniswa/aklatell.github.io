rules_version = '2';
        service cloud.firestore {
          match /databases/{database}/documents {
            match /users/{userId} {
              allow read: if true;
              allow create: if request.auth != null && request.auth.uid == userId;
              allow update: if request.auth != null && request.auth.uid == userId;
              allow delete: if request.auth != null && request.auth.uid == userId;
            }
            
            match /messages/{messageId} {
              allow read: if request.auth != null && 
                           resource.data.recipientId == request.auth.uid;
              allow create: if request.resource.data.content.size() > 0 && 
                              request.resource.data.content.size() <= 500;
              allow delete: if request.auth != null && 
                              resource.data.recipientId == request.auth.uid;
            }
          }
        }